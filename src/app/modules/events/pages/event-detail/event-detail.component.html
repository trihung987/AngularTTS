<div *ngIf="isLoading()" class="loading-overlay">ƒêang t·∫£i d·ªØ li·ªáu...</div>
<div *ngIf="error" class="error-message">{{ error }}</div>

<ng-container *ngIf="event">
  <!-- Existing content remains the same -->
  <div class="all">
    <div class="banner">
      <div class="concert-container">
        <div class="info-panel">
          <div>
            <h1 class="concert-title">{{ event.eventName }}</h1>

            <div class="event-details">
              <div class="detail-row">
                <span class="detail-icon">üóìÔ∏è</span>
                <div>
                  {{ event.startTime }} - {{ event.endTime }},
                  {{ formatDate(event.startDate) }}
                </div>
              </div>

              <div class="detail-row">
                <span class="detail-icon">üìç</span>
                <div>
                  <div class="venue-name">{{ event.venue.address }}</div>
                  <div class="venue-address">{{ event.venue.province }}</div>
                </div>
              </div>
            </div>
          </div>

          <div>
            <div class="pricing">
              <div class="price-label">Gi√° t·ª´</div>
              <div class="price-amount">
                {{ formatCurrency(getMinPrice()) }}
              </div>
            </div>
            <button class="buy-btn" (click)="navigateToZoneSelection()" [disabled]="isLateTime() || isAllSoldOut()"
              [class.disabled]="isLateTime() || isAllSoldOut()">
              {{ isLateTime() ? "ƒê√£ di·ªÖn ra" : isAllSoldOut()? "H·∫øt v√©" : "Mua v√© ngay" }}
            </button>
          </div>
        </div>

        <div
          class="event-banner"
          [style.background-image]="'url(' + event.eventBanner + ')'"
        ></div>
      </div>
    </div>

    <div class="content">
      <div class="left-content">
        <div class="detail-content">
          <h2>Gi·ªõi thi·ªáu</h2>
          <div
            class="intro-content"
            [class.expanded]="isDescriptionExpanded()"
            [innerHTML]="event.eventDescription"
          ></div>

          <img
            *ngIf="isDescriptionExpanded()"
            class="event-image-full"
            [src]="event.eventImage"
            alt="event.eventName"
          />

          <div class="toggle-btn" (click)="toggleDescription()">
            {{ isDescriptionExpanded() ? "Thu g·ªçn ‚ñ≤" : "Xem th√™m ‚ñº" }}
          </div>
        </div>

        <div class="ticket-info">
          <div class="ticket-header">
            <div class="ticket-info-header">
              <div>Th√¥ng tin v√©</div>
              <span
                >{{ event.startTime }} - {{ event.endTime }},
                {{ formatDate(event.startDate) }}</span
              >
            </div>
            <button class="buy-btn" (click)="navigateToZoneSelection()" [disabled]="isLateTime() || isAllSoldOut()"
              [class.disabled]="isLateTime() || isAllSoldOut()">
              {{ isLateTime() ? "ƒê√£ di·ªÖn ra" : isAllSoldOut()? "H·∫øt v√©" : "Mua v√© ngay" }}
            </button>
          </div>

          <div class="ticket-body">
            <div *ngFor="let zone of getSellableZones()" class="ticket-row">
              <div class="ticket-name">
                {{ zone.name }}
                {{ zone.isSeatingZone ? "(Seated)" : "(Standing)" }}
              </div>
              <div class="ticket-price">{{ formatCurrency(zone.price) }}</div>
            </div>
          </div>
        </div>

        <div class="organizer">
          <h1>Ban t·ªï ch·ª©c</h1>
          <div class="org-content">
            <div class="left-org">
              <img
                class="logo"
                [src]="event.organizer.logo"
                alt="event.organizer.name"
              />
            </div>
            <div class="right-org">
              <h1 class="org-name">{{ event.organizer.name }}</h1>
              <p class="org-bio">{{ event.organizer.bio }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<!-- Reservation Dialog - MOVED OUTSIDE ng-container -->
<p-dialog
  [(visible)]="showReservationDialog"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
  [style]="{ width: '90%', 'max-width': '500px' }"
  styleClass="reservation-dialog"
  header="ƒê·∫∑t v√© ƒëang ch·ªù x·ª≠ l√Ω">

  <!-- Dialog Content -->
  <div class="dialog-content">
    <div class="dialog-icon">
      <i class="pi pi-info-circle"></i>
    </div>

    <div class="dialog-message">
      <p>B·∫°n c√≥ m·ªôt ƒë∆°n ƒë·∫∑t v√© ƒëang ch·ªù x·ª≠ l√Ω.</p>

      <div class="reservation-details" *ngIf="existingReservation">
        <strong>M√£ gi·ªØ ch·ªó:</strong><br>

        <div class="reservation-id">
          <span class="highlight">{{ existingReservation }}</span>
        </div>
      </div>

      <p class="dialog-question">B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c v·ªõi ƒë∆°n ƒë·∫∑t v√© n√†y kh√¥ng?</p>

      <div *ngIf="isCancellingReservation()" class="cancelling-loader">
        <i class="pi pi-spin pi-spinner"></i>
        <span>ƒêang h·ªßy ƒë·∫∑t v√©...</span>
      </div>
    </div>
  </div>

  <!-- Dialog Footer -->
  <ng-template pTemplate="footer" #footer>
    <div class="custom-dialog-footer">
      <button
        aria-label="H·ªßy ƒë·∫∑t v√©"
        pButton
        type="button"
        label="H·ªßy ƒë·∫∑t v√©"
        icon="pi pi-times"
        class="p-button-text p-button-danger"
        [disabled]="isCancellingReservation()"
        (click)="cancelExistingReservation()">
      </button>
      <button
        aria-label="Ti·∫øp t·ª•c ƒë·∫∑t v√©"
        pButton
        type="button"
        label="Ti·∫øp t·ª•c"
        icon="pi pi-check"
        class="p-button-primary"
        [disabled]="isCancellingReservation()"
        (click)="continueReservation()">
      </button>
    </div>
  </ng-template>
</p-dialog>
