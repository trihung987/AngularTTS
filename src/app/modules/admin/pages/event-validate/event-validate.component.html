<div class="container">
  <div class="header">
    <h1>üé´ Event Review Dashboard</h1>
    <p>Qu·∫£n l√Ω v√† ph√™ duy·ªát s·ª± ki·ªán m·ªôt c√°ch chuy√™n nghi·ªáp</p>
  </div>

  <!-- Search and filters -->
  <div class="search-section">
    <div class="search-wrapper">
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
        placeholder="T√¨m ki·∫øm s·ª± ki·ªán..."
        class="search-input"
        aria-label="T√¨m ki·∫øm s·ª± ki·ªán"
      />
      <button class="btn btn-primary" type="button" (click)="onSearch()">
        üîç T√¨m ki·∫øm
      </button>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="isLoading()" class="loading-state">
    <p>ƒêang t·∫£i...</p>
  </div>

  <!-- Events grid -->
  <div class="events" *ngIf="!isLoading() && events.length > 0">
    <div
      class="event-card"
      *ngFor="let event of events"
      (click)="openDialog(event)"
      tabindex="0"
      role="button"
      aria-label="Xem chi ti·∫øt s·ª± ki·ªán"
    >
      <div class="event-card-banner">
        <img
          aria-label="Event Banner"
          [src]="getImg(event.eventBanner) || getPlaceholderImage(600, 160, 'Banner t·∫°m')"
          [alt]="event.eventName || 'Banner s·ª± ki·ªán'"
        />
      </div>
      <div class="event-card-content">
        <h3>{{ event.eventName }}</h3>
        <div class="event-meta">
          <div class="event-meta-item">{{ event.eventCategory || '‚Äî' }}</div>
          <div class="event-meta-item">{{ event.venue?.province || '‚Äî' }}</div>
        </div>
        <div class="event-description">{{ event.eventDescription }}</div>
        <div class="event-card-footer">
          <span class="seats-badge">{{ getTotalSeats(event) }} gh·∫ø</span>
          <button
            class="btn btn-ghost"
            type="button"
            (click)="openDialog(event); $event.stopPropagation()"
          >
            Xem chi ti·∫øt
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading() && totalPages > 1" class="pagination">
    <div class="pagination-controls">
      <button
        class="btn btn-ghost"
        type="button"
        [disabled]="currentPage === 0"
        (click)="onPageChange(currentPage - 1)"
      >
        ‚Üê Tr∆∞·ªõc
      </button>
      <span class="page-info">
        Trang {{ currentPage + 1 }} / {{ totalPages }}
      </span>
      <button
        class="btn btn-ghost"
        type="button"
        [disabled]="currentPage >= totalPages - 1"
        (click)="onPageChange(currentPage + 1)"
      >
        Sau ‚Üí
      </button>
    </div>
  </div>

  <!-- Empty state -->
  <div *ngIf="!isLoading() && events.length === 0" class="empty-state">
    <h3>Kh√¥ng c√≥ s·ª± ki·ªán n√†o</h3>
    <p>Kh√¥ng t√¨m th·∫•y s·ª± ki·ªán c·∫ßn ph√™ duy·ªát.</p>
  </div>
</div>

<!-- Modal Dialog -->
<div
  class="overlay"
  *ngIf="selectedEvent as ev"
  [class.active]="isDialogOpen()"
  role="dialog"
  [attr.aria-modal]="isDialogOpen() ? 'true' : null"
>
  <div class="dialog" role="document">
    <div class="dialog-header">
      <div class="dialog-header-left">
        <img
          [src]="getImg(ev.organizer.logo) || getPlaceholderImage(40, 40, '')"
          alt="Organizer Logo"
        />
        <div>
          <h2>{{ ev.eventName }}</h2>
          <span class="status-badge">{{ ev.eventStatus }}</span>
        </div>
      </div>
      <button class="btn btn-ghost btn-close" type="button" (click)="closeDialog()">
        ‚úï ƒê√≥ng
      </button>
    </div>

    <div class="dialog-body">
      <div class="left-panel">
        <img
          [src]="getImg(ev.eventBanner) || getPlaceholderImage(600, 160, 'Banner')"
          alt="banner"
          class="event-banner-large"
        />

        <div class="info-group">
          <div class="info-label">T√™n s·ª± ki·ªán</div>
          <div class="info-value">{{ ev.eventName }}</div>
        </div>

        <div class="info-group">
          <div class="info-label">üìÖ Th·ªùi gian</div>
          <div class="info-value">{{ getEventDateRange(ev) }}</div>
        </div>

        <div class="info-group">
          <div class="info-label">üìç ƒê·ªãa ƒëi·ªÉm</div>
          <div class="info-value">{{ getVenueDisplay(ev) }}</div>
        </div>

        <div class="info-group">
          <div class="info-label">Danh m·ª•c</div>
          <div class="info-value">{{ ev.eventCategory || '‚Äî' }}</div>
        </div>

        <div class="info-group">
          <div class="info-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</div>
          <div class="info-value">{{ formatDate(ev.updatedDate) }}</div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" type="button" (click)="approveEvent()">
            ‚úì Ph√™ duy·ªát
          </button>
          <button class="btn btn-danger" type="button" (click)="rejectEvent()">
            ‚úï T·ª´ ch·ªëi
          </button>
        </div>

        <div class="stats-card">
          <div class="stat-row">
            <span class="stat-label">T·ªïng s·ªë gh·∫ø</span>
            <span class="stat-value">{{ getTotalSeats(ev) }}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Doanh thu d·ª± ki·∫øn</span>
            <span class="stat-value">{{ formatCurrency(getTotalRevenue(ev)) }}</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">Ch·ªß s·ªü h·ªØu</span>
            <span class="stat-value">{{ ev.ownerName || '‚Äî' }}</span>
          </div>
        </div>
      </div>

      <div class="right-panel">
        <div class="tabs" role="tablist" aria-label="Event detail tabs">
          <button
            id="tab-info"
            type="button"
            role="tab"
            class="tab"
            [class.active]="activeTab === 'info'"
            [attr.aria-selected]="activeTab === 'info'"
            aria-controls="panel-info"
            (click)="switchTab('info')"
          >
            üìã Th√¥ng tin
          </button>
          <button
            id="tab-zones"
            aria-label="Zones Tab"
            type="button"
            role="tab"
            class="tab"
            [class.active]="activeTab === 'zones'"
            [attr.aria-selected]="activeTab === 'zones'"
            aria-controls="panel-zones"
            (click)="switchTab('zones')"
          >
            üé≠ Zones
          </button>
          <button
            id="tab-bank"
            type="button"
            role="tab"
            class="tab"
            [class.active]="activeTab === 'bank'"
            [attr.aria-selected]="activeTab === 'bank'"
            aria-controls="panel-bank"
            (click)="switchTab('bank')"
          >
            üè¶ Bank
          </button>
        </div>

        <!-- Info Panel -->
        <div
          class="tab-panel"
          id="panel-info"
          role="tabpanel"
          aria-labelledby="tab-info"
          *ngIf="activeTab === 'info'"
        >
          <div class="info-group">
            <div class="info-label">T√™n s·ª± ki·ªán</div>
            <div class="info-value">{{ ev.eventName || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">Danh m·ª•c</div>
            <div class="info-value">{{ ev.eventCategory || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">H√¨nh ·∫£nh ƒë·∫°i di·ªán</div>
            <img
              [src]="getImg(ev.eventImage) || getPlaceholderImage(600, 160, 'Event Image')"
              alt="Event Image"
              class="event-image-preview"
            />
          </div>
          <div class="info-group">
            <div class="info-label">Banner s·ª± ki·ªán</div>
            <img
              [src]="getImg(ev.eventBanner) || getPlaceholderImage(600, 160, 'Banner')"
              alt="Event Banner"
              class="event-image-preview event-banner-preview"
            />
          </div>
          <div class="info-group">
            <div class="info-label">M√¥ t·∫£</div>
            <div class="info-value">{{ ev.eventDescription || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">T·ªï ch·ª©c</div>
            <div class="info-value">{{ getOrganizerDisplay(ev) }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">ƒê·ªãa ƒëi·ªÉm</div>
            <div class="info-value">{{ getVenueDisplay(ev) }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">Th·ªùi gian</div>
            <div class="info-value">{{ getEventDateRange(ev) }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">Timezone</div>
            <div class="info-value">{{ ev.timezone || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</div>
            <div class="info-value">{{ formatDate(ev.updatedDate) }}</div>
          </div>
        </div>

        <!-- Zones Panel -->
        <div
          class="tab-panel"
          id="panel-zones"
          role="tabpanel"
          aria-labelledby="tab-zones"
          *ngIf="activeTab === 'zones'"
        >
          <div class="zone-grid" *ngIf="ev.zones && ev.zones.length > 0; else noZones">
            <div class="zone-card" *ngFor="let zone of ev.zones">
              <div class="zone-card-left">
                <div class="zone-color-box" [style.background]="zone.color"></div>
                <div class="zone-info">
                  <h4>{{ zone.name }}</h4>
                  <div class="zone-meta">
                    Gi√°: {{ formatCurrency(zone.price) }}<br />
                    {{ zone.isSeatingZone ? 'C√≥ ch·ªó ng·ªìi' : 'Kh√¥ng c√≥ ch·ªó ng·ªìi' }}<br />
                    {{ zone.isSellable ? 'C√≥ th·ªÉ b√°n' : 'Kh√¥ng th·ªÉ b√°n' }}
                  </div>
                </div>
              </div>
              <div class="zone-progress">
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="getZoneProgress(zone)"></div>
                </div>
                <div class="zone-meta">{{ zone.soldTickets || 0 }}/{{ zone.maxTickets || 0 }} v√©</div>
              </div>
            </div>
          </div>
          <ng-template #noZones>
            <div class="empty-zones">Kh√¥ng c√≥ zone n√†o</div>
          </ng-template>

          <div class="seating-map" *ngIf="ev.zones && ev.zones.length > 0">
            <div class="svg-container">
              <!-- Canvas-based seating map -->
              <canvas #reviewCanvas style="width: 100%; height: 280px;"></canvas>
            </div>
            <div class="legend-panel">
              <div class="legend-title">üé® Legend</div>
              <div class="legend-item" *ngFor="let zone of ev.zones">
                <div class="legend-color" [style.background]="zone.color"></div>
                <span>{{ zone.name }}</span>
              </div>
              <div class="legend-hint">
                üí° Click v√†o zone tr√™n b·∫£n ƒë·ªì ƒë·ªÉ xem chi ti·∫øt
              </div>
              <div class="zone-detail-box" *ngIf="selectedZone">
                <h4>{{ selectedZone.name }}</h4>
                <div class="zone-meta">
                  M√¥ t·∫£: {{ selectedZone.description || '‚Äî' }}<br />
                  Gi√°: {{ formatCurrency(selectedZone.price) }}<br />
                  {{ selectedZone.soldTickets || 0 }}/{{ selectedZone.maxTickets || 0 }} v√© ƒë√£ b√°n<br />
                  {{ selectedZone.isSeatingZone ? 'C√≥ ch·ªó ng·ªìi' : 'Kh√¥ng c√≥ ch·ªó ng·ªìi' }}<br />
                  {{ selectedZone.isSellable ? 'C√≥ th·ªÉ b√°n' : 'Kh√¥ng th·ªÉ b√°n' }}<br />
                  Xoay: {{ selectedZone.rotation || 0 }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Bank Panel -->
        <div
          class="tab-panel"
          id="panel-bank"
          role="tabpanel"
          aria-labelledby="tab-bank"
          *ngIf="activeTab === 'bank'"
        >
          <div class="info-group">
            <div class="info-label">Ch·ªß t√†i kho·∫£n</div>
            <div class="info-value">{{ ev.bankInfo?.accountHolder || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">S·ªë t√†i kho·∫£n</div>
            <div class="info-value">{{ ev.bankInfo?.accountNumber || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">Ng√¢n h√†ng</div>
            <div class="info-value">{{ ev.bankInfo?.bankName || '‚Äî' }}</div>
          </div>
          <div class="info-group">
            <div class="info-label">Chi nh√°nh</div>
            <div class="info-value">{{ ev.bankInfo?.bankBranch || '‚Äî' }}</div>
          </div>
        </div>
      </div>
    </div>

    <div class="dialog-footer">
      <button class="btn btn-ghost" type="button" (click)="closeDialog()">ƒê√≥ng</button>
    </div>
  </div>
</div>

<!-- PrimeNG Confirm Dialogs -->
<p-confirmDialog key="approveEvent"></p-confirmDialog>
<p-confirmDialog key="rejectEvent"></p-confirmDialog>
