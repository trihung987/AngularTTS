<div class="container">
  <div class="main-wrapper">
    <h1 class="main-title">Thi·∫øt k·∫ø s∆° ƒë·ªì ch·ªó ng·ªìi</h1>

    <div class="layout-grid">
      <div class="sidebar">
        <div class="panel">
          <h2 class="panel-title">T·∫°o Zone M·ªõi</h2>
          <div class="form-group">
            <label class="form-label">T√™n Zone</label>
            <input
              type="text"
              [(ngModel)]="newZone.name"
              placeholder="e.g., VIP, S√¢n kh·∫•u"
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label class="form-label">M√†u s·∫Øc</label>
            <div class="color-input-group">
              <input
                aria-label="Color Picker"
                type="color"
                [(ngModel)]="newZone.color"
                class="color-picker"
              />
              <input
                aria-label="Color"
                type="text"
                [(ngModel)]="newZone.color"
                class="form-input color-text"
              />
            </div>
          </div>
          <div class="form-group form-check">
            <input
              type="checkbox"
              id="isSellableNew"
              [(ngModel)]="newZone.isSellable"
              class="form-check-input"
            />
            <label for="isSellableNew" class="form-check-label"
              >Zone b√°n v√©</label
            >
          </div>

          <div *ngIf="newZone.isSellable">
            <div class="form-group">
              <label class="form-label">Gi√° v√© ($)</label>
              <input
                aria-label="Price"
                type="number"
                [(ngModel)]="newZone.price"
                min="0"
                step="5"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label class="form-label">S·ª©c ch·ª©a t·ªëi ƒëa (s·ªë v√©)</label>
              <input
                aria-label="Max Tickets"
                type="number"
                [(ngModel)]="newZone.maxTickets"
                min="0"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label class="form-label">M√¥ t·∫£ Zone</label>
              <textarea
                aria-label="Description"
                [(ngModel)]="newZone.description"
                class="form-textarea"
                rows="3"
                placeholder="e.g., T·∫ßm nh√¨n ƒë·∫πp, g·∫ßn l·ªëi ra..."
              ></textarea>
            </div>
            <div class="form-group toggle-switch">
              <label class="form-label">Lo·∫°i Zone</label>
              <div>
                <input
                  aria-label="isSeatingZoneNew"
                  type="checkbox"
                  id="isSeatingZoneNew"
                  [(ngModel)]="newZone.isSeatingZone"
                  class="toggle-switch-input"
                />
                <label for="isSeatingZoneNew" class="toggle-switch-label">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
                <span class="toggle-status-label">{{
                  newZone.isSeatingZone ? 'Zone c√≥ gh·∫ø ng·ªìi' : 'Zone ƒë·ª©ng'
                }}</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">H√¨nh d·∫°ng</label>
            <select
              [(ngModel)]="newZone.shape"
              class="form-select"
              aria-label="Zone shape"
            >
              <option value="rectangle">H√¨nh ch·ªØ nh·∫≠t</option>
              <option value="circle">H√¨nh tr√≤n</option>
              <option value="ellipse">H√¨nh elip</option>
              <option value="triangle">Tam gi√°c</option>
              <option value="polygon">L·ª•c gi√°c</option>
            </select>
          </div>
          <button
            (click)="addZone()"
            [disabled]="!newZone.name || !newZone.color"
            class="btn-primary btn-full"
          >
            <span>+ Th√™m Zone</span>
          </button>
        </div>

        <div class="panel">
          <h2 class="panel-title">Danh s√°ch Zone</h2>
          <div class="zone-list">
            <div
              *ngFor="let zone of zones"
              class="zone-item"
              [class.selected]="selectedZone?.id === zone.id"
              (click)="selectZone(zone)"
            >
              <div class="zone-header">
                <div class="zone-info">
                  <div
                    class="color-indicator"
                    [style.background-color]="zone.color"
                  ></div>
                  <div class="zone-details">
                    <p class="zone-name">
                      {{ zone.name }}
                      <span
                        class="zone-type-indicator"
                        *ngIf="zone.isSellable"
                        >{{
                          zone.isSeatingZone ? '(SEATING)' : '(STANDING)'
                        }}</span
                      >
                    </p>
                    <p class="zone-price" *ngIf="zone.isSellable">
                      ${{ zone.price }}
                    </p>
                  </div>
                </div>
                <div class="zone-actions">
                  <button
                    (click)="editZone(zone); $event.stopPropagation()"
                    class="btn-icon"
                    title="Ch·ªânh s·ª≠a Zone"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    (click)="deleteZone(zone.id); $event.stopPropagation()"
                    class="btn-icon btn-danger"
                    title="X√≥a Zone"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </div>
              <div class="zone-stats">
                <span *ngIf="zone.isSellable"
                  >S·ª©c ch·ª©a: {{ zone.maxTickets || 0 }} ‚Ä¢
                </span>
                {{ getShapeLabel(zone.shape) }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="canvas-area">
        <div class="panel tool">
          <h3 class="panel-subtitle">üõ†Ô∏è C√¥ng c·ª•</h3>
          <div class="tool-buttons">
            <button
              (click)="setTool('zone')"
              [class]="'btn-tool ' + (tool === 'zone' ? 'active' : '')"
            >
              üéØ V·∫Ω Zone
            </button>
            <button
              (click)="setTool('select')"
              [class]="'btn-tool ' + (tool === 'select' ? 'active' : '')"
            >
              üëÜ Ch·ªçn/Di chuy·ªÉn
            </button>
          </div>

          <div class="tool-actions" style="margin-top: 16px">
            <button
              (click)="showRemoveConfirmation()"
              [disabled]="!canRemove"
              class="btn-danger"
              title="X√≥a zone ƒë√£ ch·ªçn"
            >
              üóëÔ∏è X√≥a ƒë√£ ch·ªçn
            </button>
            <div class="canvas-actions">
              <button (click)="initializeCanvas()" class="btn-yellow">
                üîÑ T·∫£i l·∫°i s∆° ƒë·ªì
              </button>
              <button (click)="showClearConfirmation()" class="btn-secondary">
                üóëÔ∏è X√≥a t·∫•t c·∫£
              </button>
              <button (click)="exportLayout()" class="btn-success">
                üíæ Xu·∫•t s∆° ƒë·ªì
              </button>
            </div>
          </div>
        </div>

        <div class="panel canvas-panel">
          <div class="canvas-header">
            <h2 class="panel-title">{{ currentEventName }} - S∆° ƒë·ªì ƒë·ªãa ƒëi·ªÉm</h2>
          </div>

          <div class="canvas-container">
            <canvas
              #canvas
              width="1000"
              height="700"
              class="venue-canvas"
              (mousedown)="onMouseDown($event)"
              (mousemove)="onMouseMove($event)"
              (mouseup)="onMouseUp($event)"
              (click)="onCanvasClick($event)"
            ></canvas>

            <div class="instructions-overlay">
              <div [ngSwitch]="tool">
                <div *ngSwitchCase="'zone'">
                  <strong>üéØ V·∫Ω Zone:</strong> Ch·ªçn zone t·ª´ danh s√°ch, sau ƒë√≥
                  click v√† k√©o tr√™n canvas ƒë·ªÉ v·∫Ω.
                </div>
                <div *ngSwitchCase="'select'">
                  <strong>üëÜ Ch·ªçn/Di chuy·ªÉn:</strong> Click v√†o zone ƒë·ªÉ ch·ªçn.
                  Click v√† k√©o ƒë·ªÉ di chuy·ªÉn.
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="selectedZone" class="selection-info">
            <div class="selected-item">
              <strong>Zone ƒë√£ ch·ªçn:</strong> {{ selectedZone.name }}
              <span *ngIf="selectedZone.isSellable"
                >(S·ª©c ch·ª©a: {{ selectedZone.maxTickets || 0 }}, ${{
                  selectedZone.price
                }}
                m·ªói v√©)</span
              >
              <span *ngIf="!selectedZone.isSellable"> (Trang tr√≠)</span>
            </div>
          </div>

          <div class="zone-statistics">
            <div *ngFor="let zone of zones" class="stat-card">
              <div class="stat-header">
                <div
                  class="stat-color"
                  [style.background-color]="zone.color"
                ></div>
                <span class="stat-name">{{ zone.name }}</span>
              </div>
              <div class="stat-details">
                <div
                  class="stat-item"
                  *ngIf="zone.isSellable; else decorative"
                >
                  S·ª©c ch·ª©a: {{ zone.maxTickets || 0 }}
                  <span class="zone-type-indicator"
                    >{{ zone.isSeatingZone ? '(SEATING)' : '(STANDING)' }}
                  </span>
                </div>
                <ng-template #decorative>
                  <div class="stat-item">Trang tr√≠</div>
                </ng-template>
                <div class="stat-item" *ngIf="zone.isSellable">
                  T·ªïng: ${{ (zone.maxTickets || 0) * zone.price }}
                </div>
                <div class="stat-item">
                  H√¨nh: {{ getShapeLabel(zone.shape) }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="showClearDialog" class="modal-overlay" (click)="cancelClear()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3 class="modal-title">‚ö†Ô∏è X√≥a t·∫•t c·∫£ Zone?</h3>
        <p class="modal-message">
          ƒêi·ªÅu n√†y s·∫Ω reset v·ªã tr√≠ t·∫•t c·∫£ c√°c zone. H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n
          t√°c.
        </p>
        <div class="modal-actions">
          <button (click)="cancelClear()" class="btn-secondary">H·ªßy</button>
          <button (click)="confirmClear()" class="btn-danger">
            ƒê·ªìng √Ω, x√≥a t·∫•t c·∫£
          </button>
        </div>
      </div>
    </div>

    <div
      *ngIf="showRemoveDialog"
      class="modal-overlay"
      (click)="cancelRemove()"
    >
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3 class="modal-title">üóëÔ∏è X√≥a m·ª•c ƒë√£ ch·ªçn?</h3>
        <p class="modal-message" *ngIf="selectedZone">
          B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a zone "{{ selectedZone.name }}"?
        </p>
        <div class="modal-actions">
          <button (click)="cancelRemove()" class="btn-secondary">H·ªßy</button>
          <button (click)="confirmRemove()" class="btn-danger">X√≥a</button>
        </div>
      </div>
    </div>

    <div *ngIf="editingZone" class="modal-overlay" (click)="cancelEdit()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3 class="modal-title">‚úèÔ∏è Ch·ªânh s·ª≠a Zone</h3>
        <div class="modal-form">
          <div class="form-group">
            <label class="form-label">T√™n Zone</label>
            <input
              aria-label="Zone name"
              type="text"
              [(ngModel)]="editingZone.name"
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label class="form-label">M√†u s·∫Øc</label>
            <div class="color-input-group">
              <input
                aria-label="Color Picker"
                type="color"
                [(ngModel)]="editingZone.color"
                class="color-picker"
              />
              <input
                aria-label="Color"
                type="text"
                [(ngModel)]="editingZone.color"
                class="form-input color-text"
              />
            </div>
          </div>
          <div class="form-group form-check">
            <input
              type="checkbox"
              id="isSellableEdit"
              [(ngModel)]="editingZone.isSellable"
              class="form-check-input"
            />
            <label for="isSellableEdit" class="form-check-label"
              >Zone b√°n v√©</label
            >
          </div>

          <div *ngIf="editingZone.isSellable">
            <div class="form-group">
              <label class="form-label">Gi√° v√© ($)</label>
              <input
                aria-label="Price"
                type="number"
                [(ngModel)]="editingZone.price"
                min="0"
                step="5"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label class="form-label">S·ª©c ch·ª©a t·ªëi ƒëa (s·ªë v√©)</label>
              <input
                aria-label="Max Tickets"
                type="number"
                [(ngModel)]="editingZone.maxTickets"
                min="0"
                class="form-input"
              />
            </div>
            <div class="form-group">
              <label class="form-label">M√¥ t·∫£ Zone</label>
              <textarea
                aria-label="Description"
                [(ngModel)]="editingZone.description"
                class="form-textarea"
                rows="3"
                placeholder="e.g., T·∫ßm nh√¨n ƒë·∫πp, g·∫ßn l·ªëi ra..."
              ></textarea>
            </div>
            <div class="form-group toggle-switch">
              <label class="form-label">Lo·∫°i Zone</label>
              <div>
                <input
                  aria-label="isSeatingZone"
                  type="checkbox"
                  id="isSeatingZoneEdit"
                  [(ngModel)]="editingZone.isSeatingZone"
                  class="toggle-switch-input"
                />
                <label for="isSeatingZoneEdit" class="toggle-switch-label">
                  <span class="toggle-switch-inner"></span>
                  <span class="toggle-switch-switch"></span>
                </label>
                <span class="toggle-status-label">{{
                  editingZone.isSeatingZone ? 'Zone c√≥ gh·∫ø ng·ªìi' : 'Zone ƒë·ª©ng'
                }}</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">H√¨nh d·∫°ng</label>
            <select
              [(ngModel)]="editingZone.shape"
              name="shape"
              class="form-select"
              aria-label="Zone shape"
            >
              <option value="rectangle">H√¨nh ch·ªØ nh·∫≠t</option>
              <option value="circle">H√¨nh tr√≤n</option>
              <option value="ellipse">H√¨nh elip</option>
              <option value="triangle">Tam gi√°c</option>
              <option value="polygon">L·ª•c gi√°c</option>
            </select>
          </div>
        </div>
        <div class="modal-actions">
          <button (click)="cancelEdit()" class="btn-secondary">H·ªßy</button>
          <button (click)="saveEdit()" class="btn-primary">
            L∆∞u thay ƒë·ªïi
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
